-- 완벽한 기능 데이터 마이그레이션 스크립트
-- 이 스크립트는 기존 ai_services 테이블의 features 데이터와 
-- feature-icons.tsx의 하드코딩된 기능 설명을 모두 고려합니다

-- 1. 기존 데이터 확인
SELECT 
  s.id,
  s.name as service_name,
  s.features,
  jsonb_array_length(s.features) as feature_count
FROM ai_services s
WHERE features IS NOT NULL 
  AND jsonb_array_length(features) > 0
ORDER BY s.name;

-- 2. 기능별 아이콘과 설명 매핑을 위한 임시 테이블 생성
CREATE TEMP TABLE feature_mappings (
  feature_name TEXT PRIMARY KEY,
  icon_name TEXT,
  description TEXT
);

-- 3. feature-icons.tsx의 데이터를 기반으로 매핑 데이터 삽입
INSERT INTO feature_mappings (feature_name, icon_name, description) VALUES
-- AI 생성 기능들
('텍스트-이미지 생성', 'Image', '텍스트 설명을 통해 이미지를 생성합니다.'),
('텍스트-비디오 생성', 'Video', '텍스트 설명을 통해 비디오를 생성합니다.'),
('이미지-비디오 생성', 'Film', '이미지를 기반으로 비디오를 생성합니다.'),
('텍스트-음악 생성', 'Music', '텍스트 설명을 통해 음악을 생성합니다.'),
('텍스트-음성 변환', 'Volume2', '텍스트를 자연스러운 음성으로 변환합니다.'),
('AI 음성 생성', 'Mic', 'AI 기술을 활용하여 음성을 생성합니다.'),
('AI 음성 합성', 'AudioWaveform', 'AI 기술로 자연스러운 음성을 합성합니다.'),
('AI 콘텐츠 생성', 'Sparkles', 'AI를 활용하여 다양한 콘텐츠를 생성합니다.'),
('AI 비디오 생성', 'Video', 'AI 기술로 비디오를 생성합니다.'),
('AI 비디오 편집', 'Clapperboard', 'AI 기술을 활용하여 비디오를 편집합니다.'),
('AI 이미지 생성', 'Image', 'AI 기술로 이미지를 생성합니다.'),
('AI 스토리 생성', 'BookOpen', 'AI를 활용하여 스토리를 생성합니다.'),
('AI 스크립트 생성', 'FileText', 'AI를 활용하여 스크립트를 생성합니다.'),
('AI 글쓰기 도구', 'PenTool', '더 나은 글쓰기, 더 효율적인 문서 작성을 도와드립니다.'),
('AI 음성 스튜디오', 'Headphones', '텍스트를 자연스러운 음성으로 변환하고 목소리 톤과 감정을 세밀하게 조정합니다.'),
('AI 작곡', 'Music2', 'AI 기술을 활용하여 음악을 작곡합니다.'),
('AI 코드 생성', 'Code', 'AI가 코드를 자동으로 생성해줍니다.'),
('AI 대화', 'MessageSquare', 'AI와 자연스러운 대화를 나눕니다.'),
('AI 번역', 'Languages', 'AI 기술로 정확한 번역을 제공합니다.'),
('AI 검색', 'Search', 'AI 기반의 향상된 검색 기능을 제공합니다.'),
('AI 분석', 'BarChart', 'AI를 활용한 데이터 분석을 제공합니다.'),
('AI 요약', 'FileText', 'AI가 텍스트를 요약해줍니다.'),
('AI 디자인', 'Palette', 'AI 기술을 활용한 디자인 작업을 지원합니다.'),
('AI 편집', 'Edit', 'AI 기반의 편집 기능을 제공합니다.'),
('AI 음악 생성', 'Music', 'AI로 음악을 생성합니다.'),
('AI 보이스 클로닝', 'UserCheck', 'AI로 음성을 복제합니다.'),
('AI 아바타', 'User', 'AI 기반 아바타를 생성합니다.'),
('AI 프레젠테이션', 'Presentation', 'AI가 프레젠테이션 제작을 도와줍니다.'),
('AI 마케팅', 'TrendingUp', 'AI 기반 마케팅 도구를 제공합니다.'),
('AI 챗봇', 'Bot', 'AI 챗봇 기능을 제공합니다.'),
('AI 어시스턴트', 'Users', 'AI 어시스턴트가 작업을 도와줍니다.'),
('AI 연구', 'GraduationCap', 'AI 기반 연구 도구를 제공합니다.'),
('AI 학습', 'BookOpen', 'AI 기반 학습 도구를 제공합니다.'),
('실시간 대화', 'MessageCircle', '실시간으로 대화를 나눌 수 있습니다.'),
('멀티모달 AI', 'Layers', '텍스트, 이미지, 음성 등 다양한 형태의 입출력을 지원합니다.'),
('웹 검색', 'Globe', '웹에서 정보를 검색하고 활용합니다.'),
('파일 업로드', 'Upload', '파일을 업로드하여 분석하거나 처리할 수 있습니다.'),
('API 제공', 'Code2', 'API를 통해 서비스를 연동할 수 있습니다.'),
('플러그인 지원', 'Puzzle', '다양한 플러그인으로 기능을 확장할 수 있습니다.'),
('코드 실행', 'Terminal', '코드를 직접 실행하고 결과를 확인할 수 있습니다.'),
('데이터 분석', 'BarChart2', '데이터를 분석하고 인사이트를 제공합니다.'),
('이미지 인식', 'Eye', '이미지를 인식하고 분석합니다.'),
('음성 인식', 'Mic2', '음성을 인식하고 텍스트로 변환합니다.'),
('다국어 지원', 'Globe2', '다양한 언어를 지원합니다.'),
('맞춤 설정', 'Settings', '사용자 맞춤 설정이 가능합니다.'),
('협업 기능', 'Users2', '팀과 함께 협업할 수 있습니다.'),
('버전 관리', 'GitBranch', '작업물의 버전을 관리할 수 있습니다.'),
('실시간 피드백', 'Zap', '실시간으로 피드백을 제공합니다.'),
('자동화', 'Workflow', '반복적인 작업을 자동화합니다.'),
('통합 검색', 'Search', '여러 소스에서 통합 검색이 가능합니다.'),
('보안 강화', 'Shield', '강화된 보안 기능을 제공합니다.'),
('클라우드 저장', 'Cloud', '클라우드에 데이터를 안전하게 저장합니다.'),
('오프라인 사용', 'WifiOff', '오프라인에서도 사용 가능합니다.'),
('모바일 앱', 'Smartphone', '모바일 앱을 제공합니다.'),
('브라우저 확장', 'Chrome', '브라우저 확장 프로그램을 제공합니다.'),
('템플릿 제공', 'FileTemplate', '다양한 템플릿을 제공합니다.'),
('실시간 협업', 'Users', '실시간으로 협업이 가능합니다.'),
('AI 파워드', 'Cpu', 'AI 기술로 구동됩니다.'),
('무제한 생성', 'Infinity', '무제한으로 콘텐츠를 생성할 수 있습니다.'),
('고급 필터', 'Filter', '고급 필터링 옵션을 제공합니다.'),
('일괄 처리', 'Package', '여러 작업을 한 번에 처리할 수 있습니다.'),
('히스토리 추적', 'History', '작업 히스토리를 추적할 수 있습니다.'),
('실시간 미리보기', 'Eye', '실시간으로 결과를 미리 볼 수 있습니다.'),
('드래그 앤 드롭', 'Move', '드래그 앤 드롭으로 쉽게 사용할 수 있습니다.'),
('키보드 단축키', 'Command', '키보드 단축키를 지원합니다.'),
('다크 모드', 'Moon', '다크 모드를 지원합니다.'),
('통계 대시보드', 'BarChart3', '상세한 통계 대시보드를 제공합니다.'),
('실시간 알림', 'Bell', '실시간 알림을 받을 수 있습니다.'),
('소셜 미디어 연동', 'Share2', '소셜 미디어와 연동됩니다.'),
('이메일 연동', 'Mail', '이메일과 연동됩니다.'),
('캘린더 연동', 'Calendar', '캘린더와 연동됩니다.'),
('Slack 연동', 'Hash', 'Slack과 연동됩니다.'),
('Zapier 연동', 'Zap', 'Zapier와 연동됩니다.'),
('웹훅 지원', 'Webhook', '웹훅을 지원합니다.'),
('SSO 지원', 'Key', 'Single Sign-On을 지원합니다.'),
('2단계 인증', 'Lock', '2단계 인증을 지원합니다.'),
('팀 관리', 'Users', '팀 관리 기능을 제공합니다.'),
('권한 관리', 'Shield', '세부적인 권한 관리가 가능합니다.'),
('감사 로그', 'FileSearch', '모든 활동에 대한 감사 로그를 제공합니다.'),
('데이터 내보내기', 'Download', '데이터를 내보낼 수 있습니다.'),
('데이터 가져오기', 'Upload', '데이터를 가져올 수 있습니다.'),
('백업 및 복원', 'HardDrive', '백업 및 복원 기능을 제공합니다.'),
('커스텀 도메인', 'Globe', '커스텀 도메인을 설정할 수 있습니다.'),
('화이트 라벨', 'Tag', '화이트 라벨 옵션을 제공합니다.'),
('우선 지원', 'Headset', '우선 고객 지원을 제공합니다.'),
('전담 매니저', 'UserCheck', '전담 계정 매니저가 배정됩니다.'),
('SLA 보장', 'FileCheck', 'SLA를 보장합니다.'),
('무료 체험', 'Gift', '무료 체험 기간을 제공합니다.'),
('환불 보장', 'DollarSign', '환불 보장 정책이 있습니다.'),
('라이브 채팅 지원', 'MessageSquare', '실시간 채팅 지원을 제공합니다.'),
('비디오 튜토리얼', 'PlayCircle', '비디오 튜토리얼을 제공합니다.'),
('온보딩 지원', 'UserPlus', '온보딩 과정을 지원합니다.'),
('정기 업데이트', 'RefreshCw', '정기적으로 업데이트됩니다.'),
('커뮤니티 포럼', 'Users', '커뮤니티 포럼을 운영합니다.'),
('개발자 문서', 'BookOpen', '상세한 개발자 문서를 제공합니다.'),
('오픈 소스', 'Github', '오픈 소스로 제공됩니다.'),
('프라이버시 보호', 'Lock', '사용자 프라이버시를 보호합니다.'),
('GDPR 준수', 'Shield', 'GDPR 규정을 준수합니다.'),
('ISO 인증', 'Award', 'ISO 인증을 받았습니다.'),
('엔터프라이즈 준비', 'Building', '엔터프라이즈 환경에 적합합니다.'),
('확장 가능', 'Maximize', '필요에 따라 확장 가능합니다.'),
('고성능', 'Zap', '높은 성능을 제공합니다.'),
('저지연', 'Activity', '낮은 지연 시간을 보장합니다.'),
('글로벌 CDN', 'Globe', '글로벌 CDN을 통해 빠른 속도를 제공합니다.'),
('A/B 테스트', 'GitBranch', 'A/B 테스트 기능을 제공합니다.'),
('분석 도구', 'TrendingUp', '상세한 분석 도구를 제공합니다.'),
('맞춤형 보고서', 'FileBarChart', '맞춤형 보고서를 생성할 수 있습니다.'),
('예약 발행', 'Clock', '콘텐츠를 예약 발행할 수 있습니다.'),
('다중 프로젝트', 'Folders', '여러 프로젝트를 관리할 수 있습니다.'),
('태그 시스템', 'Tag', '태그로 콘텐츠를 정리할 수 있습니다.'),
('검색 기능', 'Search', '강력한 검색 기능을 제공합니다.'),
('필터링', 'Filter', '다양한 필터링 옵션을 제공합니다.'),
('정렬 옵션', 'ArrowUpDown', '다양한 정렬 옵션을 제공합니다.'),
('페이지네이션', 'ChevronRight', '페이지네이션을 지원합니다.'),
('무한 스크롤', 'ChevronsDown', '무한 스크롤을 지원합니다.'),
('반응형 디자인', 'Monitor', '모든 기기에서 최적화된 디자인을 제공합니다.'),
('PWA 지원', 'Smartphone', 'Progressive Web App을 지원합니다.'),
('오프라인 동기화', 'CloudOff', '오프라인에서도 작업 후 동기화가 가능합니다.'),
('실시간 저장', 'Save', '작업 내용이 실시간으로 저장됩니다.'),
('버전 비교', 'GitCompare', '버전 간 비교가 가능합니다.'),
('롤백 기능', 'RotateCcw', '이전 버전으로 롤백할 수 있습니다.'),
('코멘트 시스템', 'MessageSquare', '코멘트를 남길 수 있습니다.'),
('멘션 기능', 'AtSign', '@멘션 기능을 지원합니다.'),
('알림 설정', 'Bell', '알림을 세부적으로 설정할 수 있습니다.'),
('단축 URL', 'Link', '단축 URL을 생성할 수 있습니다.'),
('QR 코드', 'QrCode', 'QR 코드를 생성할 수 있습니다.'),
('임베드 기능', 'Code', '다른 사이트에 임베드할 수 있습니다.'),
('위젯 제공', 'Square', '위젯을 제공합니다.'),
('커스텀 CSS', 'Palette', '커스텀 CSS를 적용할 수 있습니다.'),
('커스텀 JS', 'Code', '커스텀 JavaScript를 실행할 수 있습니다.'),
('폼 빌더', 'FileInput', '폼을 쉽게 만들 수 있습니다.'),
('설문 도구', 'ClipboardList', '설문을 만들고 관리할 수 있습니다.'),
('이메일 마케팅', 'Mail', '이메일 마케팅 도구를 제공합니다.'),
('SMS 마케팅', 'MessageSquare', 'SMS 마케팅을 지원합니다.'),
('푸시 알림', 'Bell', '푸시 알림을 보낼 수 있습니다.'),
('인앱 메시지', 'MessageCircle', '인앱 메시지를 표시할 수 있습니다.'),
('고객 세분화', 'Users', '고객을 세분화하여 관리할 수 있습니다.'),
('행동 추적', 'Activity', '사용자 행동을 추적할 수 있습니다.'),
('전환 추적', 'Target', '전환을 추적할 수 있습니다.'),
('ROI 분석', 'TrendingUp', 'ROI를 분석할 수 있습니다.'),
('히트맵', 'Map', '히트맵을 제공합니다.'),
('세션 녹화', 'Video', '사용자 세션을 녹화할 수 있습니다.'),
('폼 분석', 'FileBarChart', '폼 성과를 분석할 수 있습니다.'),
('깔때기 분석', 'Filter', '전환 깔때기를 분석할 수 있습니다.'),
('코호트 분석', 'Users', '코호트 분석을 제공합니다.'),
('예측 분석', 'TrendingUp', '예측 분석을 제공합니다.'),
('이상 탐지', 'AlertTriangle', '이상 패턴을 자동으로 탐지합니다.'),
('실시간 대시보드', 'Monitor', '실시간 대시보드를 제공합니다.'),
('커스텀 지표', 'BarChart', '커스텀 지표를 만들 수 있습니다.'),
('목표 설정', 'Target', '목표를 설정하고 추적할 수 있습니다.'),
('경쟁사 분석', 'Users', '경쟁사를 분석할 수 있습니다.'),
('시장 인사이트', 'TrendingUp', '시장 인사이트를 제공합니다.'),
('고객 피드백', 'MessageSquare', '고객 피드백을 수집합니다.'),
('NPS 측정', 'BarChart', 'NPS를 측정할 수 있습니다.'),
('감성 분석', 'Heart', '텍스트의 감성을 분석합니다.'),
('키워드 추출', 'Hash', '키워드를 자동으로 추출합니다.'),
('요약 생성', 'FileText', '텍스트를 자동으로 요약합니다.'),
('번역 기능', 'Languages', '다국어 번역을 지원합니다.'),
('음성 전사', 'Mic', '음성을 텍스트로 전사합니다.'),
('OCR 기능', 'ScanLine', '이미지에서 텍스트를 추출합니다.'),
('바코드 스캔', 'Barcode', '바코드를 스캔할 수 있습니다.'),
('얼굴 인식', 'User', '얼굴을 인식할 수 있습니다.'),
('객체 인식', 'Box', '이미지에서 객체를 인식합니다.'),
('장면 인식', 'Image', '이미지의 장면을 인식합니다.'),
('감정 인식', 'Smile', '얼굴에서 감정을 인식합니다.'),
('제스처 인식', 'Hand', '제스처를 인식합니다.'),
('음성 명령', 'Mic', '음성 명령을 인식합니다.'),
('자연어 이해', 'MessageSquare', '자연어를 이해하고 처리합니다.'),
('의도 파악', 'Target', '사용자의 의도를 파악합니다.'),
('엔티티 추출', 'Tag', '텍스트에서 엔티티를 추출합니다.'),
('관계 추출', 'Link', '엔티티 간 관계를 추출합니다.'),
('질문 응답', 'HelpCircle', '질문에 대한 답변을 제공합니다.'),
('대화 관리', 'MessageSquare', '대화 흐름을 관리합니다.'),
('문맥 이해', 'FileText', '문맥을 이해하고 처리합니다.'),
('다중 턴 대화', 'MessageCircle', '여러 턴의 대화를 지원합니다.'),
('개인화', 'User', '사용자별 개인화를 제공합니다.'),
('추천 시스템', 'ThumbsUp', '개인화된 추천을 제공합니다.'),
('콘텐츠 큐레이션', 'Bookmark', '콘텐츠를 큐레이션합니다.'),
('자동 태깅', 'Tag', '콘텐츠를 자동으로 태깅합니다.'),
('중복 제거', 'Copy', '중복 콘텐츠를 제거합니다.'),
('품질 평가', 'Star', '콘텐츠 품질을 평가합니다.'),
('표절 검사', 'FileSearch', '표절을 검사합니다.'),
('문법 검사', 'CheckCircle', '문법을 검사하고 교정합니다.'),
('스타일 가이드', 'FileText', '스타일 가이드를 적용합니다.'),
('톤 조정', 'Sliders', '글의 톤을 조정할 수 있습니다.'),
('가독성 분석', 'Eye', '텍스트의 가독성을 분석합니다.'),
('SEO 최적화', 'Search', 'SEO를 최적화합니다.'),
('메타 태그', 'Tag', '메타 태그를 자동 생성합니다.'),
('구조화 데이터', 'Database', '구조화된 데이터를 생성합니다.'),
('사이트맵', 'Map', '사이트맵을 자동 생성합니다.'),
('링크 검사', 'Link', '깨진 링크를 검사합니다.'),
('성능 최적화', 'Zap', '성능을 최적화합니다.'),
('이미지 최적화', 'Image', '이미지를 자동으로 최적화합니다.'),
('지연 로딩', 'Clock', '지연 로딩을 지원합니다.'),
('캐싱', 'HardDrive', '효율적인 캐싱을 제공합니다.'),
('압축', 'Package', '데이터를 압축하여 전송합니다.'),
('보안 스캔', 'Shield', '보안 취약점을 스캔합니다.'),
('SSL 인증서', 'Lock', 'SSL 인증서를 제공합니다.'),
('DDoS 보호', 'Shield', 'DDoS 공격으로부터 보호합니다.'),
('방화벽', 'Shield', '웹 애플리케이션 방화벽을 제공합니다.'),
('암호화', 'Lock', '데이터를 암호화합니다.'),
('접근 제어', 'Key', '세밀한 접근 제어를 제공합니다.'),
('감사 추적', 'FileSearch', '모든 활동을 추적합니다.'),
('컴플라이언스', 'FileCheck', '각종 규정을 준수합니다.'),
('백업', 'HardDrive', '자동 백업을 제공합니다.'),
('재해 복구', 'AlertTriangle', '재해 복구 계획을 제공합니다.'),
('모니터링', 'Activity', '24/7 모니터링을 제공합니다.'),
('알림', 'Bell', '이상 상황 시 즉시 알림을 보냅니다.'),
('자동 스케일링', 'Maximize', '트래픽에 따라 자동으로 스케일링합니다.'),
('로드 밸런싱', 'Shuffle', '로드 밸런싱을 제공합니다.'),
('멀티 리전', 'Globe', '여러 지역에서 서비스를 제공합니다.'),
('엣지 컴퓨팅', 'Cpu', '엣지에서 컴퓨팅을 수행합니다.'),
('서버리스', 'Cloud', '서버리스 아키텍처를 지원합니다.'),
('컨테이너', 'Package', '컨테이너 기반 배포를 지원합니다.'),
('CI/CD', 'GitBranch', 'CI/CD 파이프라인을 제공합니다.'),
('롤링 업데이트', 'RefreshCw', '무중단 업데이트를 지원합니다.'),
('블루-그린 배포', 'ToggleLeft', '블루-그린 배포를 지원합니다.'),
('카나리 배포', 'GitBranch', '카나리 배포를 지원합니다.'),
('피처 플래그', 'ToggleLeft', '피처 플래그를 지원합니다.'),
('A/B 테스팅', 'GitBranch', 'A/B 테스트를 쉽게 수행할 수 있습니다.'),
('다변량 테스트', 'BarChart', '다변량 테스트를 지원합니다.'),
('통계적 유의성', 'TrendingUp', '통계적 유의성을 계산합니다.'),
('세그먼테이션', 'Users', '사용자를 세그먼트로 나눕니다.'),
('타겟팅', 'Target', '특정 사용자를 타겟팅할 수 있습니다.'),
('개인화 엔진', 'User', '고급 개인화 엔진을 제공합니다.'),
('머신러닝', 'Cpu', '머신러닝 기능을 제공합니다.'),
('예측 모델', 'TrendingUp', '예측 모델을 구축할 수 있습니다.'),
('이상 탐지', 'AlertTriangle', '이상 패턴을 자동으로 탐지합니다.'),
('자동 분류', 'Tag', '콘텐츠를 자동으로 분류합니다.'),
('클러스터링', 'Circle', '데이터를 클러스터링합니다.'),
('차원 축소', 'Minimize', '데이터의 차원을 축소합니다.'),
('피처 추출', 'Filter', '중요한 피처를 추출합니다.'),
('모델 학습', 'Brain', '커스텀 모델을 학습시킬 수 있습니다.'),
('전이 학습', 'GitBranch', '전이 학습을 지원합니다.'),
('파인 튜닝', 'Sliders', '모델을 파인 튜닝할 수 있습니다.'),
('모델 배포', 'Rocket', '학습된 모델을 쉽게 배포할 수 있습니다.'),
('모델 버전 관리', 'GitBranch', '모델 버전을 관리합니다.'),
('모델 모니터링', 'Activity', '배포된 모델을 모니터링합니다.'),
('드리프트 감지', 'AlertTriangle', '모델 드리프트를 감지합니다.'),
('재학습', 'RefreshCw', '모델을 자동으로 재학습합니다.'),
('설명 가능한 AI', 'Info', 'AI의 결정을 설명할 수 있습니다.'),
('편향 감지', 'AlertTriangle', 'AI의 편향을 감지합니다.'),
('공정성 평가', 'Scale', 'AI의 공정성을 평가합니다.'),
('프라이버시 보존', 'Lock', '프라이버시를 보존하는 AI를 제공합니다.'),
('연합 학습', 'Users', '연합 학습을 지원합니다.'),
('엣지 AI', 'Smartphone', '엣지 디바이스에서 AI를 실행합니다.'),
('경량 모델', 'Feather', '경량화된 AI 모델을 제공합니다.'),
('양자화', 'Binary', '모델을 양자화하여 최적화합니다.'),
('프루닝', 'Scissors', '모델을 프루닝하여 경량화합니다.'),
('지식 증류', 'Droplet', '지식 증류를 통해 모델을 압축합니다.'),
('하이브리드 AI', 'Layers', '여러 AI 기술을 결합합니다.'),
('앙상블 모델', 'Users', '여러 모델을 앙상블로 사용합니다.'),
('메타 학습', 'Brain', '메타 학습을 지원합니다.'),
('원샷 학습', 'Target', '원샷 학습을 지원합니다.'),
('제로샷 학습', 'Circle', '제로샷 학습을 지원합니다.'),
('자기 지도 학습', 'User', '자기 지도 학습을 지원합니다.'),
('강화 학습', 'Trophy', '강화 학습을 지원합니다.'),
('생성적 적대 신경망', 'Zap', 'GAN을 활용한 생성 기능을 제공합니다.'),
('변분 오토인코더', 'Shuffle', 'VAE를 활용한 생성 기능을 제공합니다.'),
('트랜스포머', 'Transform', '트랜스포머 모델을 활용합니다.'),
('어텐션 메커니즘', 'Eye', '어텐션 메커니즘을 사용합니다.'),
('BERT 기반', 'FileText', 'BERT 기반 모델을 활용합니다.'),
('GPT 기반', 'MessageSquare', 'GPT 기반 모델을 활용합니다.'),
('확산 모델', 'Sparkles', '확산 모델을 활용한 생성 기능을 제공합니다.'),
('LoRA 적용', 'Layers', '특정 스타일이나 캐릭터를 학습한 LoRA 모델을 적용하여 일관된 이미지를 생성합니다.'),
('오픈소스 모델', 'Github', '오픈소스 AI 모델을 자유롭게 사용하고 커스터마이징할 수 있습니다.'),
('V7 모델', 'Sparkles', '최신 V7 이미지 생성 모델로 더욱 정교하고 현실적인 이미지를 생성합니다.'),
('Gen-4 모델', 'Cpu', '4세대 AI 모델의 향상된 성능으로 더 정확하고 창의적인 결과물을 제공합니다.'),
('Jasper Chat', 'MessageSquare', '마케팅 전문 AI 어시스턴트로 브랜드 톤앤매너에 맞는 콘텐츠 제작을 지원합니다.'),
('Chatsonic', 'Mic', '실시간 정보 검색과 음성 대화가 가능한 차세대 AI 챗봇 서비스입니다.'),
('Photosonic', 'Image', '텍스트 설명만으로 고품질 AI 아트워크와 사실적인 이미지를 생성합니다.'),
('Botsonic', 'Bot', '웹사이트용 맞춤형 AI 챗봇을 노코드로 구축하고 고객 서비스를 자동화합니다.')
ON CONFLICT DO NOTHING;

-- 4. 기존 service_functions 테이블 비우기 (기존 데이터가 있다면)
TRUNCATE TABLE service_functions;

-- 5. 마이그레이션 실행
DO $$
DECLARE
  service_record RECORD;
  feature_item TEXT;
  feature_order INTEGER;
  feature_icon TEXT;
  feature_desc TEXT;
BEGIN
  -- 모든 서비스를 순회
  FOR service_record IN 
    SELECT id, name, features 
    FROM ai_services 
    WHERE features IS NOT NULL AND jsonb_array_length(features) > 0
  LOOP
    RAISE NOTICE '서비스 % 처리 중...', service_record.name;
    feature_order := 0;
    
    -- 각 서비스의 features 배열을 순회
    FOR feature_item IN 
      SELECT jsonb_array_elements_text(service_record.features)
    LOOP
      -- 매핑 테이블에서 아이콘과 설명 찾기
      SELECT icon_name, description 
      INTO feature_icon, feature_desc
      FROM feature_mappings 
      WHERE feature_name = feature_item;
      
      -- 매핑이 없으면 기본값 사용
      IF feature_icon IS NULL THEN
        feature_icon := 'Zap';
        feature_desc := '이 기능을 통해 더욱 효율적인 작업이 가능합니다.';
      END IF;
      
      -- service_functions 테이블에 삽입
      INSERT INTO service_functions (
        service_id, 
        name, 
        description,
        icon_name,
        display_order,
        is_active
      ) VALUES (
        service_record.id,
        feature_item,
        feature_desc,
        feature_icon,
        feature_order,
        true
      );
      
      feature_order := feature_order + 1;
    END LOOP;
    
    RAISE NOTICE '서비스 %: %개 기능 추가됨', service_record.name, feature_order;
  END LOOP;
END $$;

-- 6. 마이그레이션 결과 확인
SELECT 
  s.name as service_name,
  COUNT(sf.id) as function_count,
  array_agg(sf.name ORDER BY sf.display_order) as functions
FROM ai_services s
LEFT JOIN service_functions sf ON s.id = sf.service_id
GROUP BY s.id, s.name
ORDER BY s.name;

-- 7. 총 마이그레이션된 기능 수
SELECT COUNT(*) as total_migrated_functions FROM service_functions;

-- 8. 임시 테이블 삭제
DROP TABLE IF EXISTS feature_mappings;